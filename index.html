<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes" /> 
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/icon.png" />
  <link rel="manifest" href="/manifest.json" />

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('✅ Service Worker registered'))
        .catch(err => console.error('Service Worker registration failed:', err));
    }
  </script>

  <title>watermelon_drop 1.0</title> 
  <style type="text/css">
    /* Keep your existing styles mostly unchanged */

    html, body {
      margin: 0;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
      height: 100%;
      overflow: hidden; /* no scroll */
      background-color: #ffffff;
    }

    body {
      position: fixed; /* Prevent overscroll */
      margin: 0;
      padding: 0;
    }

    .canvas-app-container {
      width: 100%;
      height: 100%;
      position: absolute;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: linear-gradient(135deg, #fafcff 0%, #fafcff 50%, #f5f9ff 50%, #f5f9ff 100%);
      /* padding top fix for notch */
      padding-top: env(safe-area-inset-top);
      box-sizing: border-box;
    }

    #canvas {
      outline: none;
      border: 0;
      width: 100%;
      vertical-align: bottom;
      display: block;
    }

    /* Your other styles here unchanged... */

  </style> 

  <script src="/poki/poki-sdk.js"></script>
  <script src="/scripts/gamepog.bundle.js"></script>
</head> 
<body> 

  <div id="running-from-file-warning" style="display: none; margin: 3em;"> 
    <h1>Running from local file ⚠️</h1> 
    <p>It seems like you have opened this file by double-clicking on it. In order to test your build in a browser <b>you need to load this file from a web server</b>. You can either upload this file and the rest of the files from a Defold HTML5 bundle to a web hosting service OR host them using a local web server on your home network.</p> 
    <p><a href="https://defold.com/manuals/html5/#testing-html5-build" target="_blank">Learn more about running a local web server in the Defold HTML5 manual</a>.</p> 
  </div> 

  <div id="app-container" class="canvas-app-container"> 
    <div id="canvas-container" class="canvas-app-canvas-container"> 
      <canvas id="canvas" class="canvas-app-canvas" tabindex="1" width="1280" height="720"></canvas> 
    </div> 
    <div class="buttons-background"></div> 
  </div> 

  <script id="engine-loader" type="text/javascript" src="dmloader.js"></script> 

  <script id="engine-setup" type="text/javascript">
    var extra_params = {
      archive_location_filter: function( path ) {
        return ("archive" + path + "");
      },
      engine_arguments: ["--verify-graphics-calls=false",],
      custom_heap_size: 33554432,
      full_screen_container: "#canvas-container",
      disable_context_menu: true
    };

    Module['INITIAL_MEMORY'] = extra_params.custom_heap_size;

    Module['onRuntimeInitialized'] = function() {
      PokiSDK.init().then(() => {
        PokiSDK.gameLoadingFinished();
        Module.runApp("canvas", extra_params);
      }).catch(() => {
        Module.runApp("canvas", extra_params);
      });
    };

    Module["locateFile"] = function(path, scriptDirectory) {
      if (path == "dmengine.wasm" || path == "dmengine_release.wasm" || path == "dmengine_headless.wasm") {
        path = "watermelon_drop.wasm";
      }
      return scriptDirectory + path;
    };

    var is_iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
    var buttonHeight = 0;
    var prevInnerWidth = -1;
    var prevInnerHeight = -1;
    function resize_game_canvas() {
      // Hack for iOS when exit from Fullscreen mode
      if (is_iOS) {
        window.scrollTo(0, 0);
      }

      var app_container = document.getElementById('app-container');
      var game_canvas = document.getElementById('canvas');
      var innerWidth = window.innerWidth;
      var innerHeight = window.innerHeight - buttonHeight;
      if (prevInnerWidth == innerWidth && prevInnerHeight == innerHeight)
      {
        return;
      }
      prevInnerWidth = innerWidth;
      prevInnerHeight = innerHeight;
      var width = 1280;
      var height = 720;
      var targetRatio = width / height;
      var actualRatio = innerWidth / innerHeight;

      //Stretch (your original logic)
      width = innerWidth;
      height = innerHeight;

      app_container.style.width = width + "px";
      app_container.style.height = height + buttonHeight + "px";
      game_canvas.width = width;
      game_canvas.height = height;
    }
    resize_game_canvas();
    window.addEventListener('resize', resize_game_canvas, false);
    window.addEventListener('orientationchange', resize_game_canvas, false);
    window.addEventListener('focus', resize_game_canvas, false);
  </script> 

  <script id="engine-start" type="text/javascript">
    var runningFromFileWarning = document.getElementById("running-from-file-warning");
    if (window.location.href.startsWith("file://")) {
      runningFromFileWarning.style.display = "block";
    }
    else {
      EngineLoader.stream_wasm = "false" === "true";
      EngineLoader.load("canvas", "watermelon_drop");
      runningFromFileWarning.parentNode.removeChild(runningFromFileWarning);
    }
  </script>   

  <script id="poki-sdk-setup" type="text/javascript">
    PokiSDK.gameLoadingStart();
    var data = {};
    var isLoadFinished = false;
    Progress.addListener(function(percentage){
      data.percentageDone = percentage / 100;
      if (!isLoadFinished)
        PokiSDK.gameLoadingProgress(data);
      if (percentage == 100 && !isLoadFinished) {
        PokiSDK.gameLoadingFinished();
        isLoadFinished = true;
      }
    });
  </script>
 </body>
</html>
