<!doctype html>
<html lang="en">
<head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes"> 

  <!-- PWA manifest -->
  <link rel="manifest" href="/manifest.json" />
  <!-- iOS support -->
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="apple-touch-icon" href="/icon.png" />

  <!-- Service-worker registration -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/service-worker.js')
        .then(() => console.log('✅ Service Worker registered'))
        .catch(err => console.error('Service Worker registration failed:', err));
    }
  </script>

  <title>watermelon_drop 1.0</title> 
  <style type="text/css">
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background-color: #ffffff;
      font-family: sans-serif;
      overscroll-behavior: none;
      touch-action: none;
    }

    body {
      padding-top: env(safe-area-inset-top);
      padding-left: env(safe-area-inset-left);
      padding-right: env(safe-area-inset-right);
      padding-bottom: env(safe-area-inset-bottom);
    }

    .canvas-app-container {
      width: 100%;
      height: 100%;
      position: absolute;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      background: linear-gradient(135deg, #fafcff 0%, #fafcff 50%, #f5f9ff 50%, #f5f9ff 100%);
    }

    .canvas-app-container:-webkit-full-screen {
      width: auto;
      height: auto;
    }

    #canvas {
      display: block;
      position: absolute;
      outline: none;
      border: 0;
    }

    #canvas-container {
      position: relative;
    }

    canvas:focus, canvas:active {
      outline: none;
      border: 0;
      -moz-outline-style: none;
    }

    div {
      -webkit-tap-highlight-color: rgba(0,0,0,0);
      -webkit-touch-callout: none;
      -webkit-user-select: none;
      -khtml-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }

    .canvas-app-progress {
      position: absolute;
      background-color: #d1dbeb;
      height: 6px;
      margin-top: -6px;
      width: 100%;
    }

    .canvas-app-progress-bar {
      font-size: 12px;
      height: 6px;
      color: white;
      background-color: #1a72eb;
      text-align: center;
      line-height: 20px;
    }

    .link, .button {
      font-size: 14px;
      padding-top: 12px;
    }

    .buttons-background {
      background-color: #ffffff;
      width: 100%;
      height: 42px;
    }

    .canvas-app-canvas {
      background-repeat: no-repeat;
      background-position: center center;
      background-image: url("idle.gif");
    }
  </style> 

  <script src="/poki/poki-sdk.js"></script>
  <script src="/scripts/gamepog.bundle.js"></script>
</head> 

<body> 
  <div id="running-from-file-warning" style="display: none; margin: 3em;"> 
    <h1>Running from local file ⚠️</h1> 
    <p>It seems like you have opened this file by double-clicking on it. In order to test your build in a browser <b>you need to load this file from a web server</b>.</p> 
    <p><a href="https://defold.com/manuals/html5/#testing-html5-build" target="_blank">Learn more</a>.</p> 
  </div> 

  <div id="app-container" class="canvas-app-container"> 
    <div id="canvas-container" class="canvas-app-canvas-container"> 
      <canvas id="canvas" class="canvas-app-canvas" tabindex="1" width="1280" height="720"></canvas> 
    </div> 
    <div class="buttons-background"></div> 
  </div> 

  <script id="engine-loader" type="text/javascript" src="dmloader.js"></script> 

  <script id="engine-setup" type="text/javascript">
    var extra_params = {
      archive_location_filter: path => ("archive" + path),
      engine_arguments: ["--verify-graphics-calls=false"],
      custom_heap_size: 33554432,
      full_screen_container: "#canvas-container",
      disable_context_menu: true
    };

    Module['INITIAL_MEMORY'] = extra_params.custom_heap_size;

    Module['onRuntimeInitialized'] = function () {
      PokiSDK.init().then(() => {
        PokiSDK.gameLoadingFinished();
        Module.runApp("canvas", extra_params);
      }).catch(() => {
        Module.runApp("canvas", extra_params);
      });
    };

    Module["locateFile"] = function (path, scriptDirectory) {
      if (["dmengine.wasm", "dmengine_release.wasm", "dmengine_headless.wasm"].includes(path)) {
        path = "watermelon_drop.wasm";
      }
      return scriptDirectory + path;
    };

    function resize_game_canvas() {
      const app_container = document.getElementById('app-container');
      const game_canvas = document.getElementById('canvas');

      const gameWidth = 1280;
      const gameHeight = 720;

      const windowWidth = window.innerWidth;
      const windowHeight = window.innerHeight;

      const scale = Math.min(windowWidth / gameWidth, windowHeight / gameHeight);

      const scaledWidth = gameWidth * scale;
      const scaledHeight = gameHeight * scale;

      game_canvas.style.width = `${scaledWidth}px`;
      game_canvas.style.height = `${scaledHeight}px`;

      game_canvas.style.left = `${(windowWidth - scaledWidth) / 2}px`;
      game_canvas.style.top = `${(windowHeight - scaledHeight) / 2}px`;

      app_container.style.width = `${windowWidth}px`;
      app_container.style.height = `${windowHeight}px`;
    }

    resize_game_canvas();
    window.addEventListener('resize', resize_game_canvas);
    window.addEventListener('orientationchange', resize_game_canvas);
    window.addEventListener('focus', resize_game_canvas);
  </script> 

  <script id="engine-start" type="text/javascript">
    if (window.location.href.startsWith("file://")) {
      document.getElementById("running-from-file-warning").style.display = "block";
    } else {
      EngineLoader.stream_wasm = "false" === "true";
      EngineLoader.load("canvas", "watermelon_drop");
    }
  </script>   

  <script id="poki-sdk-setup" type="text/javascript">
    PokiSDK.gameLoadingStart();
    let data = {};
    let isLoadFinished = false;
    Progress.addListener(function (percentage) {
      data.percentageDone = percentage / 100;
      if (!isLoadFinished)
        PokiSDK.gameLoadingProgress(data);
      if (percentage === 100 && !isLoadFinished) {
        PokiSDK.gameLoadingFinished();
        isLoadFinished = true;
      }
    });
  </script>
</body>
</html>
